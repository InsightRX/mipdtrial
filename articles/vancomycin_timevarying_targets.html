<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Time-varying exposure targets (vancomycin) • mipdtrial</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Time-varying exposure targets (vancomycin)">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mipdtrial</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/busulfan_mipd.html">Model misspecification, a busulfan case study</a></li>
    <li><a class="dropdown-item" href="../articles/pegasp_mipd.html">Custom initial dose nomogram, a PEG Asparaginase case study</a></li>
    <li><a class="dropdown-item" href="../articles/sample_timing_yaml.html">Effect of sample timing (YAML example)</a></li>
    <li><a class="dropdown-item" href="../articles/sample_timing.html">Effect of sample timing (R example)</a></li>
    <li><a class="dropdown-item" href="../articles/vancomycin_interval_adaptation.html">Dose and interval adaptation (vancomycin)</a></li>
    <li><a class="dropdown-item" href="../articles/vancomycin_timevarying_targets.html">Time-varying exposure targets (vancomycin)</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Time-varying exposure targets (vancomycin)</h1>
            
      

      <div class="d-none name"><code>vancomycin_timevarying_targets.Rmd</code></div>
    </div>

    
    
<p>In this vignette, we will demonstrate the following tools:</p>
<ul>
<li>using {mipdtrial} to simulate a trial, with the trial design
specified using R code.</li>
<li>using timevarying exposure targets in the trial simulations. This is
not so relevant for vancomycin, but we’ll just use that here as an
example drug.</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mipdtrial</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>   <span class="co"># for easier data manipulation </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span> <span class="co"># for plotting our results</span></span></code></pre></div>
<div class="section level2">
<h2 id="define-the-trial-design">1. Define the trial design<a class="anchor" aria-label="anchor" href="#define-the-trial-design"></a>
</h2>
<p>This simulated trial will have two samples, with a peak and trough
collected in dose 1 and 3.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tdm_design</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_sampling_design.html">create_sampling_design</a></span><span class="op">(</span></span>
<span>  offset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="co"># sample 1-hour before true trough, and at peak+1hr</span></span>
<span>  when <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"peak"</span>, <span class="st">"trough"</span>, <span class="st">"peak"</span>, <span class="st">"trough"</span><span class="op">)</span>,</span>
<span>  at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  anchor <span class="op">=</span> <span class="st">"dose"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We assume that we can update the dose amount at dose 3 and 7, and aim
for an AUC24 of 500 mg*h/L and 300 by dose 5 and 10, respectively.<br></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">target_design</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_target_design.html">create_target_design</a></span><span class="op">(</span></span>
<span>  targettype <span class="op">=</span> <span class="st">"auc24"</span>, </span>
<span>  targetvalue <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">300</span><span class="op">)</span>,</span>
<span>  at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>  anchor <span class="op">=</span> <span class="st">"dose"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">dose_update_design</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_regimen_update_design.html">create_regimen_update_design</a></span><span class="op">(</span></span>
<span>  at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">7</span><span class="op">)</span>,</span>
<span>  anchor <span class="op">=</span> <span class="st">"dose"</span>,</span>
<span>  update_type <span class="op">=</span> <span class="st">"dose"</span>,</span>
<span>  dose_optimization_method <span class="op">=</span> <span class="va">map_adjust_dose</span> <span class="co"># fixed interval, optimize dose</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We will be using the Thomson (2009) model for simulation and
estimation:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_design</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_model_design.html">create_model_design</a></span><span class="op">(</span>lib <span class="op">=</span> <span class="st">"pkvancothomson"</span><span class="op">)</span></span></code></pre></div>
<p>We will start with a dose estimated to attain the target exposure
metrics based on population PK parameters, assuming a 12-hour
interval.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">initial_method</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_initial_regimen_design.html">create_initial_regimen_design</a></span><span class="op">(</span></span>
<span>  method <span class="op">=</span> <span class="va">model_based_starting_dose</span>,</span>
<span>  regimen <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    interval <span class="op">=</span> <span class="fl">12</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"infusion"</span>,</span>
<span>    t_inf <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    n <span class="op">=</span> <span class="fl">24</span></span>
<span>  <span class="op">)</span>,</span>
<span>  settings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    auc_comp <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    dose_resolution <span class="op">=</span> <span class="fl">250</span>,</span>
<span>    dose_grid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">250</span>, <span class="fl">5000</span>, <span class="fl">250</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Now we can combine these design choices into a single trial
design:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">design</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_trial_design.html">create_trial_design</a></span><span class="op">(</span></span>
<span>  sampling_design <span class="op">=</span> <span class="va">tdm_design</span>, </span>
<span>  target_design <span class="op">=</span> <span class="va">target_design</span>,</span>
<span>  regimen_update_design <span class="op">=</span> <span class="va">dose_update_design</span>, <span class="co"># arm 1</span></span>
<span>  initial_regimen_design <span class="op">=</span> <span class="va">initial_method</span>,</span>
<span>  sim_design <span class="op">=</span> <span class="va">model_design</span>, est_design <span class="op">=</span> <span class="va">model_design</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="create-a-set-of-digital-patient-covariates">2. Create a set of digital patient covariates<a class="anchor" aria-label="anchor" href="#create-a-set-of-digital-patient-covariates"></a>
</h2>
<p>For this example, we will randomly generate a set of weights and
creatinine clearances (CRCLs) for our synthetic data set. See
<code>sampling_timing()</code> vignette for a longer description.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">15</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  ID <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">30</span>,</span>
<span>  weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">90</span>, <span class="fl">25</span><span class="op">)</span>,               <span class="co"># kg, normally distributed</span></span>
<span>  crcl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1.6</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>   <span class="co"># L/hr, log-normally distributed </span></span>
<span><span class="op">)</span></span>
<span><span class="va">dat</span><span class="op">$</span><span class="va">CL_HEMO</span> <span class="op">&lt;-</span> <span class="fl">0</span> <span class="co"># required covariate for our model</span></span></code></pre></div>
<p>We also need to link the covariates in our data set to the covariates
expected in the model:</p>
<ul>
<li>
<p>To check which covariates are required for your model use
<code><a href="https://insightrx.github.io/PKPDsim/reference/get_model_info.html" class="external-link">PKPDsim::get_model_covariates()</a></code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">PKPDsim</span><span class="fu">::</span><span class="fu"><a href="https://insightrx.github.io/PKPDsim/reference/get_model_info.html" class="external-link">get_model_covariates</a></span><span class="op">(</span><span class="va">model_design</span><span class="op">$</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "WT"      "CRCL"    "CL_HEMO"</span></span></code></pre></div>
</li>
<li>
<p>To check which covariates are in your data set use
<code><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames()</a></code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "ID"      "weight"  "crcl"    "CL_HEMO"</span></span></code></pre></div>
</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cov_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  WT <span class="op">=</span> <span class="st">"weight"</span>, </span>
<span>  CRCL <span class="op">=</span> <span class="st">"crcl"</span>,</span>
<span>  CL_HEMO <span class="op">=</span> <span class="st">"CL_HEMO"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="simulate-a-trial">4. Simulate a trial!<a class="anchor" aria-label="anchor" href="#simulate-a-trial"></a>
</h2>
<p>Patients will get a model-based dose (using population PK
parameters), and then we will adjust the dose based on the MAP Bayesian
fit made using the collected samples, first to target an AUC of 500, and
then later targeting an AUC of 300.</p>
<p>Individual PK parameters will be randomly generated based on the
interindividual variability described in the model, and residual
variability will be added to each sample collected using the error model
described in the model.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">covs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_cov_object.html">create_cov_object</a></span><span class="op">(</span></span>
<span>  <span class="va">dat</span>,</span>
<span>  mapping <span class="op">=</span> <span class="va">cov_map</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/model_based_starting_dose.html">model_based_starting_dose</a></span><span class="op">(</span></span>
<span>  design <span class="op">=</span> <span class="va">design</span>,</span>
<span>  covariates <span class="op">=</span> <span class="va">covs</span>,</span>
<span>  cov_mapping <span class="op">=</span> <span class="va">cov_mapping</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;      t     type  amt t_inf</span></span>
<span><span class="co">#&gt; 1    0 infusion 1500     1</span></span>
<span><span class="co">#&gt; 2   12 infusion 1500     1</span></span>
<span><span class="co">#&gt; 3   24 infusion 1500     1</span></span>
<span><span class="co">#&gt; 4   36 infusion 1500     1</span></span>
<span><span class="co">#&gt; 5   48 infusion 1500     1</span></span>
<span><span class="co">#&gt; 6   60 infusion 1500     1</span></span>
<span><span class="co">#&gt; 7   72 infusion 1500     1</span></span>
<span><span class="co">#&gt; 8   84 infusion 1500     1</span></span>
<span><span class="co">#&gt; 9   96 infusion 1500     1</span></span>
<span><span class="co">#&gt; 10 108 infusion 1500     1</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_trial.html">run_trial</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">dat</span>,</span>
<span>  design <span class="op">=</span> <span class="va">design</span>,</span>
<span>  cov_mapping <span class="op">=</span> <span class="va">cov_map</span>,</span>
<span>  progress <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">15</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Starting simulations in 1 threads</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Post-processing results</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="analyze-results">5. Analyze results<a class="anchor" aria-label="anchor" href="#analyze-results"></a>
</h2>
<p>Let’s see how well that worked. In the figure below we plot the
steady state AUC that is attained using the regimen updated at the time
shown on the x-axis. You would expect over time the steady state AUC to
approach the middle of the range more closely, as more TDM is available
to optimize the dose. Since we’re keeping the interval fixed, each
patient will have the same dose update times on the x-axis.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">dose_updates</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">auc_before_update</span>, group <span class="op">=</span> <span class="va">id</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">300</span>, <span class="fl">500</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Time of regimen update (Dose update algorithm)"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Resulting AUC at time points initial dose, and dose 3, 5 (mg*h/L)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="vancomycin_timevarying_targets_files/figure-html/unnamed-chunk-13-1.png" width="480"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jasmine Hughes, Ron Keizer, InsightRX.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
