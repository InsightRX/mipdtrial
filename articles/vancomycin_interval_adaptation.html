<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="mipdtrial">
<title>Dose and interval adaptation (vancomycin) • mipdtrial</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Dose and interval adaptation (vancomycin)">
<meta property="og:description" content="mipdtrial">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">mipdtrial</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/busulfan_mipd.html">Busulfan MIPD</a>
    <a class="dropdown-item" href="../articles/pegasp_mipd.html">PEG Asparaginase</a>
    <a class="dropdown-item" href="../articles/sample_timing.html">Effect of sample timing</a>
    <a class="dropdown-item" href="../articles/vancomycin_interval_adaptation.html">Dose and interval adaptation (vancomycin)</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Dose and interval adaptation (vancomycin)</h1>
            
      
      
      <div class="d-none name"><code>vancomycin_interval_adaptation.Rmd</code></div>
    </div>

    
    
<p>In model-informed precision dosing we can update doses, but of course
we can also reduce or increase the dosing interval length. This can also
be studied using the <code>mipdtrial</code> package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mipdtrial</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>   <span class="co"># for easier data manipulation </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span> <span class="co"># for plotting our results</span></span></code></pre></div>
<div class="section level2">
<h2 id="define-the-trial-design">1. Define the trial design<a class="anchor" aria-label="anchor" href="#define-the-trial-design"></a>
</h2>
<p>This simulated trial will have two samples, with a peak and trough
collected in dose 1 and 3.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tdm_design</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_sampling_design.html">create_sampling_design</a></span><span class="op">(</span></span>
<span>  offset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="co"># sample 1-hour before true trough, and at peak+1hr</span></span>
<span>  when <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"peak"</span>, <span class="st">"trough"</span>, <span class="st">"peak"</span>, <span class="st">"trough"</span><span class="op">)</span>,</span>
<span>  at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  anchor <span class="op">=</span> <span class="st">"dose"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We assume that we can update the dose amount or dosing interval at
dose 3 and 5 and aim for an AUC24 of 400-600 mg*h/L by day 6. We create
different regimen update designs for dose-optimization and interval-
optimization.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">target_design</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_target_design.html">create_target_design</a></span><span class="op">(</span></span>
<span>  targettype <span class="op">=</span> <span class="st">"auc24"</span>, </span>
<span>  targetmin <span class="op">=</span> <span class="fl">400</span>,</span>
<span>  targetmax <span class="op">=</span> <span class="fl">600</span>,</span>
<span>  at <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  anchor <span class="op">=</span> <span class="st">"day"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">dose_update_design</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_regimen_update_design.html">create_regimen_update_design</a></span><span class="op">(</span></span>
<span>  at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>  anchor <span class="op">=</span> <span class="st">"dose"</span>,</span>
<span>  update_type <span class="op">=</span> <span class="st">"dose"</span>,</span>
<span>  dose_optimization_method <span class="op">=</span> <span class="va">map_adjust_dose</span></span>
<span><span class="op">)</span></span>
<span><span class="va">interval_update_design</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_regimen_update_design.html">create_regimen_update_design</a></span><span class="op">(</span></span>
<span>  at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>  anchor <span class="op">=</span> <span class="st">"dose"</span>,</span>
<span>  update_type <span class="op">=</span> <span class="st">"interval"</span>,</span>
<span>  dose_optimization_method <span class="op">=</span> <span class="va">map_adjust_interval</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="create-a-set-of-digital-patient-covariates">2. Create a set of digital patient covariates<a class="anchor" aria-label="anchor" href="#create-a-set-of-digital-patient-covariates"></a>
</h2>
<p>For this example, we will randomly generate a set of weights and
creatinine clearances (CRCLs) for our synthetic data set. See
<code>sampling_timing()</code> vignette for a longer description.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">15</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  ID <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">30</span>,</span>
<span>  weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">90</span>, <span class="fl">25</span><span class="op">)</span>,               <span class="co"># kg, normally distributed</span></span>
<span>  crcl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1.6</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>   <span class="co"># L/hr, log-normally distributed </span></span>
<span><span class="op">)</span></span>
<span><span class="va">dat</span><span class="op">$</span><span class="va">CL_HEMO</span> <span class="op">&lt;-</span> <span class="fl">0</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="load-model-definitions">3. Load model definitions<a class="anchor" aria-label="anchor" href="#load-model-definitions"></a>
</h2>
<p>We need to define the model parameters and variability terms for our
simulation. For this study, we will use the ones defined in the
models.</p>
<pre><code><span><span class="co">#&gt; Loading required package: pkvancothomson</span></span></code></pre>
<p>We also need to link the covariates in our data set to the covariates
expected in the model.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># check which covariates are required for your model using </span></span>
<span><span class="co"># `PKPDsim::get_model_covariates(model)`</span></span>
<span></span>
<span><span class="co"># check which covariates are in your data set using `colnames(dat)`</span></span>
<span><span class="va">cov_mapping</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  WT <span class="op">=</span> <span class="st">"weight"</span>, </span>
<span>  CRCL <span class="op">=</span> <span class="st">"crcl"</span>,</span>
<span>  CL_HEMO <span class="op">=</span> <span class="st">"CL_HEMO"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="simulate-a-trial">4. Simulate a trial!<a class="anchor" aria-label="anchor" href="#simulate-a-trial"></a>
</h2>
<p>Patients will get a model-based dose (using population PK
parameters), and then we will adjust either the dose or the interval
based on the MAP Bayesian fit made using the collected samples.</p>
<p>Individual PK parameters will be randomly generated based on the
interindividual variability described in the model, and residual
variability will be added to each sample collected using the error model
described in the model.</p>
<p>First let’s simulate the “dose optimization” scenario, leaving the
interval fixed.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">15</span><span class="op">)</span> <span class="co"># important for reproducibility</span></span>
<span><span class="va">tdms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">dose_updates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">dat</span><span class="op">$</span><span class="va">ID</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co">#################################################################################</span></span>
<span>  <span class="co">## Create individual</span></span>
<span>  <span class="co">#################################################################################</span></span>
<span>  <span class="co"># get patient covariates</span></span>
<span>  <span class="va">covs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_cov_object.html">create_cov_object</a></span><span class="op">(</span></span>
<span>    <span class="va">dat</span><span class="op">[</span><span class="va">dat</span><span class="op">$</span><span class="va">ID</span> <span class="op">==</span> <span class="va">i</span>,<span class="op">]</span>,</span>
<span>    mapping <span class="op">=</span> <span class="va">cov_mapping</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="co"># randomly draw individual PK parameters</span></span>
<span>  <span class="va">pars_true_i</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_variability.html">generate_iiv</a></span><span class="op">(</span></span>
<span>    sim_model <span class="op">=</span> <span class="va">model</span>,</span>
<span>    omega <span class="op">=</span> <span class="va">omega</span>,</span>
<span>    parameters <span class="op">=</span> <span class="va">pop_parameters</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co">#################################################################################</span></span>
<span>  <span class="co">## Find initial starting dose</span></span>
<span>  <span class="co">#################################################################################</span></span>
<span>  <span class="co"># find initial starting dose: define basic regimen, then upda</span></span>
<span>  <span class="va">initial_reg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_based_starting_dose.html">model_based_starting_dose</a></span><span class="op">(</span></span>
<span>    sampling_design <span class="op">=</span> <span class="va">tdm_design</span>,</span>
<span>    target_design <span class="op">=</span> <span class="va">target_design</span>,</span>
<span>    n <span class="op">=</span> <span class="fl">12</span>,</span>
<span>    interval <span class="op">=</span> <span class="fl">12</span>,</span>
<span>    t_inf <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    dose_resolution <span class="op">=</span> <span class="fl">250</span>, <span class="co"># round to nearest 250 mg</span></span>
<span>    grid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">250</span>, <span class="fl">6000</span>, by <span class="op">=</span> <span class="fl">250</span><span class="op">)</span>,</span>
<span>    grid_type <span class="op">=</span> <span class="st">"dose"</span>,</span>
<span>    est_model <span class="op">=</span> <span class="va">model</span>,</span>
<span>    parameters <span class="op">=</span> <span class="va">pop_parameters</span>,</span>
<span>    covariates <span class="op">=</span> <span class="va">covs</span>,</span>
<span>    auc_comp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">model</span>, <span class="st">"size"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co">#################################################################################</span></span>
<span>  <span class="co">## Main patient-level loop: run through regimen optimization</span></span>
<span>  <span class="co">#################################################################################</span></span>
<span>  <span class="va">treatment_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sample_and_adjust_by_dose.html">sample_and_adjust_by_dose</a></span><span class="op">(</span></span>
<span>    regimen_update_design <span class="op">=</span> <span class="va">dose_update_design</span>, </span>
<span>    sampling_design <span class="op">=</span> <span class="va">tdm_design</span>,</span>
<span>    target_design <span class="op">=</span> <span class="va">target_design</span>,</span>
<span>    regimen <span class="op">=</span> <span class="va">initial_reg</span>,</span>
<span>    covariates <span class="op">=</span> <span class="va">covs</span>,</span>
<span>    pars_true_i <span class="op">=</span> <span class="va">pars_true_i</span>,</span>
<span>    sim_model <span class="op">=</span> <span class="va">model</span>,</span>
<span>    sim_ruv <span class="op">=</span> <span class="va">ruv</span>,</span>
<span>    est_model <span class="op">=</span> <span class="va">model</span>,</span>
<span>    parameters <span class="op">=</span> <span class="va">pop_parameters</span>,</span>
<span>    omega <span class="op">=</span> <span class="va">omega</span>,</span>
<span>    ruv <span class="op">=</span> <span class="va">ruv</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">#################################################################################</span></span>
<span>  <span class="co">## Collect data into object</span></span>
<span>  <span class="co">#################################################################################</span></span>
<span>  <span class="va">tdms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>    <span class="va">tdms</span>,</span>
<span>    <span class="va">treatment_summary</span><span class="op">$</span><span class="va">tdms</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="va">i</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">dose_updates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>    <span class="va">dose_updates</span>,</span>
<span>    <span class="va">treatment_summary</span><span class="op">$</span><span class="va">dose_updates</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="va">i</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="analyze-results-for-dose-adaptation">5. Analyze results for dose-adaptation<a class="anchor" aria-label="anchor" href="#analyze-results-for-dose-adaptation"></a>
</h2>
<p>Let’s see how well that worked. In the figure below we plot the
steady state AUC that is attained using the regimen updated at the time
shown on the x-axis. You would expect over time the steady state AUC to
approach the middle of the range more closely, as more TDM is available
to optimize the dose. Since we’re keeping the interval fixed, each
patient will have the same dose update times on the x-axis.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dose_updates</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">auc_before_update</span>, group <span class="op">=</span> <span class="va">id</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">auc_before_update</span>, group <span class="op">=</span> <span class="va">id</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>t <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">dose_updates</span><span class="op">$</span><span class="va">t</span><span class="op">)</span><span class="op">)</span>, ymin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">400</span>, <span class="fl">400</span><span class="op">)</span>, ymax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">600</span>, <span class="fl">600</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, ymin <span class="op">=</span> <span class="va">ymin</span>, ymax <span class="op">=</span> <span class="va">ymax</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"blue"</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Time of regimen update"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Resulting AUC at t=6 days"</span><span class="op">)</span></span></code></pre></div>
<p><img src="vancomycin_interval_adaptation_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="interval-adaptation">6. Interval adaptation<a class="anchor" aria-label="anchor" href="#interval-adaptation"></a>
</h2>
<p>Next, we’ll simulate a trial in which the <em>interval</em> is
optimized, and the dose is fixed (after an initial model-based dose is
obtained). Again, we’ll allow the dose to be changed after doses 3 and 5
(irrespective of interval).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interval_update_design</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_regimen_update_design.html">create_regimen_update_design</a></span><span class="op">(</span></span>
<span>  at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>  anchor <span class="op">=</span> <span class="st">"dose"</span>,</span>
<span>  update_type <span class="op">=</span> <span class="st">"interval"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">15</span><span class="op">)</span> <span class="co"># important for reproducibility</span></span>
<span><span class="va">tdms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">dose_updates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">dat</span><span class="op">$</span><span class="va">ID</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co">#################################################################################</span></span>
<span>  <span class="co">## Create individual</span></span>
<span>  <span class="co">#################################################################################</span></span>
<span>  <span class="co"># get patient covariates</span></span>
<span>  <span class="va">covs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_cov_object.html">create_cov_object</a></span><span class="op">(</span></span>
<span>    <span class="va">dat</span><span class="op">[</span><span class="va">dat</span><span class="op">$</span><span class="va">ID</span> <span class="op">==</span> <span class="va">i</span>,<span class="op">]</span>,</span>
<span>    mapping <span class="op">=</span> <span class="va">cov_mapping</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="co"># randomly draw individual PK parameters</span></span>
<span>  <span class="va">pars_true_i</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_variability.html">generate_iiv</a></span><span class="op">(</span></span>
<span>    sim_model <span class="op">=</span> <span class="va">model</span>,</span>
<span>    omega <span class="op">=</span> <span class="va">omega</span>,</span>
<span>    parameters <span class="op">=</span> <span class="va">pop_parameters</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co">#################################################################################</span></span>
<span>  <span class="co">## Find initial starting dose</span></span>
<span>  <span class="co">#################################################################################</span></span>
<span>  <span class="co"># find initial starting dose: define basic regimen, then upda</span></span>
<span>  <span class="va">initial_reg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_based_starting_dose.html">model_based_starting_dose</a></span><span class="op">(</span></span>
<span>    sampling_design <span class="op">=</span> <span class="va">tdm_design</span>,</span>
<span>    target_design <span class="op">=</span> <span class="va">target_design</span>,</span>
<span>    n <span class="op">=</span> <span class="fl">30</span>,</span>
<span>    interval <span class="op">=</span> <span class="fl">12</span>,</span>
<span>    t_inf <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    dose_resolution <span class="op">=</span> <span class="fl">250</span>, <span class="co"># round to nearest 250 mg</span></span>
<span>    grid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">250</span>, <span class="fl">6000</span>, by <span class="op">=</span> <span class="fl">250</span><span class="op">)</span>,</span>
<span>    grid_type <span class="op">=</span> <span class="st">"dose"</span>,</span>
<span>    <span class="co"># define model components</span></span>
<span>    est_model <span class="op">=</span> <span class="va">model</span>,</span>
<span>    parameters <span class="op">=</span> <span class="va">pop_parameters</span>,</span>
<span>    covariates <span class="op">=</span> <span class="va">covs</span>,</span>
<span>    auc_comp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">model</span>, <span class="st">"size"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co">#################################################################################</span></span>
<span>  <span class="co">## Main patient-level loop: run through regimen optimization</span></span>
<span>  <span class="co">#################################################################################</span></span>
<span>  <span class="va">treatment_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sample_and_adjust_by_dose.html">sample_and_adjust_by_dose</a></span><span class="op">(</span></span>
<span>    regimen_update_design <span class="op">=</span> <span class="va">interval_update_design</span>, <span class="co"># &lt;-- use interval update design now!</span></span>
<span>    grid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">8</span>, <span class="fl">12</span>, <span class="fl">16</span>, <span class="fl">24</span>, <span class="fl">36</span><span class="op">)</span>, <span class="co"># &lt;-- passed on to the optimization function as possible interval options</span></span>
<span>    sampling_design <span class="op">=</span> <span class="va">tdm_design</span>,</span>
<span>    target_design <span class="op">=</span> <span class="va">target_design</span>,</span>
<span>    regimen <span class="op">=</span> <span class="va">initial_reg</span>,</span>
<span>    covariates <span class="op">=</span> <span class="va">covs</span>,</span>
<span>    pars_true_i <span class="op">=</span> <span class="va">pars_true_i</span>,</span>
<span>    sim_model <span class="op">=</span> <span class="va">model</span>,</span>
<span>    sim_ruv <span class="op">=</span> <span class="va">ruv</span>,</span>
<span>    est_model <span class="op">=</span> <span class="va">model</span>,</span>
<span>    parameters <span class="op">=</span> <span class="va">pop_parameters</span>,</span>
<span>    omega <span class="op">=</span> <span class="va">omega</span>,</span>
<span>    ruv <span class="op">=</span> <span class="va">ruv</span>,</span>
<span>    verbose <span class="op">=</span> <span class="cn">F</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">#################################################################################</span></span>
<span>  <span class="co">## Collect data into object</span></span>
<span>  <span class="co">#################################################################################</span></span>
<span>  <span class="co"># extract metrics of interest</span></span>
<span>  <span class="va">tdms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>    <span class="va">tdms</span>,</span>
<span>    <span class="va">treatment_summary</span><span class="op">$</span><span class="va">tdms</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="va">i</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">dose_updates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>    <span class="va">dose_updates</span>,</span>
<span>    <span class="va">treatment_summary</span><span class="op">$</span><span class="va">dose_updates</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="va">i</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="analyze-results-for-interval-adaptation">7. Analyze results for interval-adaptation<a class="anchor" aria-label="anchor" href="#analyze-results-for-interval-adaptation"></a>
</h2>
<p>When we plot the results of this simulation, we now see that dose
update times are flexible, and not the same for each patient. We again
see that the resulting steady state AUC24 also approaches the middle of
the targeted AUC range. So this shows that the dosing interval can also
be used very easily to obtain optimal drug exposure.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dose_updates</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">auc_before_update</span>, group <span class="op">=</span> <span class="va">id</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">auc_before_update</span>, group <span class="op">=</span> <span class="va">id</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>t <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">dose_updates</span><span class="op">$</span><span class="va">t</span><span class="op">)</span><span class="op">)</span>, ymin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">400</span>, <span class="fl">400</span><span class="op">)</span>, ymax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">600</span>, <span class="fl">600</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, ymin <span class="op">=</span> <span class="va">ymin</span>, ymax <span class="op">=</span> <span class="va">ymax</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"blue"</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Time of regimen update"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Resulting AUC at t=6 days"</span><span class="op">)</span></span></code></pre></div>
<p><img src="vancomycin_interval_adaptation_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dose_updates</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>idx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">interval_before_update</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">idx</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Interval"</span><span class="op">)</span></span></code></pre></div>
<p><img src="vancomycin_interval_adaptation_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jasmine Hughes, Ron Keizer, InsightRX.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
