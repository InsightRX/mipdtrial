<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="mipdtrial">
<title>PEG Asparaginase • mipdtrial</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="PEG Asparaginase">
<meta property="og:description" content="mipdtrial">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">mipdtrial</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/busulfan_mipd.html">Busulfan MIPD</a>
    <a class="dropdown-item" href="../articles/pegasp_mipd.html">PEG Asparaginase</a>
    <a class="dropdown-item" href="../articles/sample_timing.html">Effect of sample timing</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>PEG Asparaginase</h1>
            
      
      
      <div class="d-none name"><code>pegasp_mipd.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mipdtrial</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/InsightRX/PKPDsim" class="external-link">PKPDsim</a></span><span class="op">)</span> <span class="co"># for working with models</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va">pkpegasparaginasemodifiedwurthwein</span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://insightrx.github.io/PKPDsim/reference/install_default_literature_model.html" class="external-link">install_default_literature_model</a></span><span class="op">(</span><span class="st">"pk_pegasparaginase_modified_wurthwein"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">NHANES</span><span class="op">)</span> <span class="co"># for example data</span></span>
<span></span>
<span><span class="co"># For data handling/plotting</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="define-simulation-parameters">1. Define simulation parameters<a class="anchor" aria-label="anchor" href="#define-simulation-parameters"></a>
</h2>
<p>PEG-asparaginase has a long half-life. In this simulation trial
patients will receive 4 doses separated by 14 days levels collected
every 14 days just prior to the next dose. We will adjust doses 2 and 3
to achieve a steady state asparaginase activity level of of 300 IU/L
(0.3 IU/mL) (goal: 0.1 - 0.5 IU/mL)</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tdm_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fl">13.9</span><span class="op">*</span><span class="fl">24</span>,  <span class="fl">27.9</span><span class="op">*</span><span class="fl">24</span>,  <span class="fl">41.9</span><span class="op">*</span><span class="fl">24</span><span class="op">)</span> </span>
<span><span class="va">adjust_at_dose</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">target</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_target_object.html">create_target_object</a></span><span class="op">(</span></span>
<span>  targettype <span class="op">=</span> <span class="st">"conc"</span>, </span>
<span>  targetvalue <span class="op">=</span> <span class="fl">300</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">conc_times</span> <span class="op">&lt;-</span> <span class="fl">1344</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="create-a-set-of-digital-patient-covariates">2. Create a set of digital patient covariates<a class="anchor" aria-label="anchor" href="#create-a-set-of-digital-patient-covariates"></a>
</h2>
<p>Synthetic dataset based on CDC growth curves of children.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">NHANES</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/NHANES/man/NHANES.html" class="external-link">NHANES</a></span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># take just the first record per patient</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">ID</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># convert columns to numeric</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">Gender</span> <span class="op">==</span> <span class="st">"male"</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># as defined in models</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Age</span><span class="op">&lt;</span><span class="fl">18</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">ID</span>, <span class="va">Sex</span>, <span class="va">Age</span>, <span class="va">Weight</span>, <span class="va">Height</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># include only patients with all information available</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Sex</span><span class="op">)</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Weight</span><span class="op">)</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Height</span><span class="op">)</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Age</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>BSA <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">Weight</span> <span class="op">*</span> <span class="va">Height</span> <span class="op">/</span> <span class="fl">3600</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 6</span></span></span>
<span><span class="co">#&gt;      ID   Sex   Age Weight Height   BSA</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> <span style="text-decoration: underline;">51</span>625     1     4   17     105. 0.705</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> <span style="text-decoration: underline;">51</span>638     1     9   29.8   133. 1.05 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> <span style="text-decoration: underline;">51</span>646     1     8   35.2   131. 1.13 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> <span style="text-decoration: underline;">51</span>659     0    10   38.6   142. 1.23 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> <span style="text-decoration: underline;">51</span>671     0     9   53.1   139. 1.43 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> <span style="text-decoration: underline;">51</span>679     1    16   73.2   172  1.87</span></span></code></pre></div>
<p>Here are the first few rows of our data set:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 6</span></span></span>
<span><span class="co">#&gt;      ID   Sex   Age Weight Height   BSA</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> <span style="text-decoration: underline;">51</span>625     1     4   17     105. 0.705</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> <span style="text-decoration: underline;">51</span>638     1     9   29.8   133. 1.05 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> <span style="text-decoration: underline;">51</span>646     1     8   35.2   131. 1.13 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> <span style="text-decoration: underline;">51</span>659     0    10   38.6   142. 1.23 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> <span style="text-decoration: underline;">51</span>671     0     9   53.1   139. 1.43 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> <span style="text-decoration: underline;">51</span>679     1    16   73.2   172  1.87</span></span></code></pre></div>
<p>While our data set is much larger, for this example let’s take just
the first 20 patients.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">ID</span>,<span class="fl">20</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="load-model-definitions">3. Load model definitions<a class="anchor" aria-label="anchor" href="#load-model-definitions"></a>
</h2>
<p>We need to define the model parameters and variability terms for our
simulation. For this study, we will use the ones defined in the
models.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set up simulation model </span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu">pkpegasparaginasemodifiedwurthwein</span><span class="fu">::</span><span class="fu">model</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">parameters</span> <span class="op">&lt;-</span> <span class="fu">pkpegasparaginasemodifiedwurthwein</span><span class="fu">::</span><span class="fu">parameters</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">omega</span> <span class="op">&lt;-</span> <span class="fu">pkpegasparaginasemodifiedwurthwein</span><span class="fu">::</span><span class="fu">omega_matrix</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">ruv</span> <span class="op">&lt;-</span> <span class="fu">pkpegasparaginasemodifiedwurthwein</span><span class="fu">::</span><span class="fu">ruv</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>We also need to link the covariates in our data set to the covariates
expected in the model.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># check which covariates are required for your model using </span></span>
<span><span class="co"># `attr(model, "covariates")`</span></span>
<span></span>
<span><span class="co"># check which covariates are in your data set using `colnames(dat)`</span></span>
<span><span class="va">cov_mapping</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  AGE <span class="op">=</span> <span class="st">"Age"</span>, </span>
<span>  WT <span class="op">=</span> <span class="st">"Weight"</span>, </span>
<span>  HT <span class="op">=</span> <span class="st">"Height"</span>, </span>
<span>  BSA <span class="op">=</span> <span class="st">"BSA"</span>,</span>
<span>  SEX <span class="op">=</span> <span class="st">"Sex"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="initialize-output-metrics-of-interest">4. Initialize output metrics of interest<a class="anchor" aria-label="anchor" href="#initialize-output-metrics-of-interest"></a>
</h2>
<p>We will pre-populate a data frame rather than iteratively binding
rows, since that is more performent.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">ids</span>,each<span class="op">=</span><span class="fl">3</span><span class="op">)</span>,</span>
<span>  iter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>,</span>
<span>  day <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">14</span>,<span class="fl">28</span>,<span class="fl">42</span><span class="op">)</span>,</span>
<span>  amt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA_real_</span>,each<span class="op">=</span><span class="fl">3</span><span class="op">)</span>,</span>
<span>  conc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA_real_</span>,each<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="simulate-a-trial">5. Simulate a trial!<a class="anchor" aria-label="anchor" href="#simulate-a-trial"></a>
</h2>
<p>Patients will start at a dose of 2000 IU/m2 if &lt;22 yo and 2500
IU/m2 if &gt;22 yo, with doses capped at a maximum total dose of 3750
IU. We will then use <code><a href="../reference/dose_grid_search.html">mipdtrial::dose_grid_search</a></code> to
optimize doses to attain a target concentration of 0.3 IU/mL.</p>
<p>For inter-individual variability terms, we will use the
inter-individual variability described by our model, since this should
reflect the distribution in patient pharmacokinetics. Later, we will
estimate the individual PK parameters using our estimation model and the
measured TDMs we “collect”.</p>
<p>For residual error terms, we will use the residual error of our
model, since this is supposed to reflect the unexplained error (assay
error, etc.). This function creates a data frame of error to add to each
simulated concentrations to produced a measured therapeutic drug
monitoring sample.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="co"># important for reproducibility</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">ids</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># get patient covariates</span></span>
<span>  <span class="va">covs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_cov_object.html">create_cov_object</a></span><span class="op">(</span></span>
<span>    <span class="va">dat</span><span class="op">[</span><span class="va">dat</span><span class="op">$</span><span class="va">ID</span> <span class="op">==</span> <span class="va">i</span>,<span class="op">]</span>,</span>
<span>    mapping <span class="op">=</span> <span class="va">cov_mapping</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="co"># use age-based nomogram</span></span>
<span>  <span class="va">dose</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">covs</span><span class="op">$</span><span class="va">AGE</span><span class="op">$</span><span class="va">value</span> <span class="op">&gt;=</span> <span class="fl">22</span>, <span class="fl">2500</span><span class="op">*</span><span class="va">covs</span><span class="op">$</span><span class="va">BSA</span><span class="op">$</span><span class="va">value</span>, <span class="fl">2000</span><span class="op">*</span><span class="va">covs</span><span class="op">$</span><span class="va">BSA</span><span class="op">$</span><span class="va">value</span><span class="op">)</span></span>
<span>  <span class="co"># capt dose to a maximum of 3750</span></span>
<span>  <span class="va">dose</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="va">dose</span>, <span class="fl">3750</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># create initial dosing regimen (see PKPDsim::new_regimen for more info)</span></span>
<span>  <span class="va">reg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://insightrx.github.io/PKPDsim/reference/new_regimen.html" class="external-link">new_regimen</a></span><span class="op">(</span></span>
<span>    amt <span class="op">=</span> <span class="va">dose</span>, </span>
<span>    interval <span class="op">=</span> <span class="fl">14</span><span class="op">*</span><span class="fl">24</span>,</span>
<span>    n <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    t_inf <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"infusion"</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># randomly draw individual PK parameters</span></span>
<span>  <span class="va">pars_true_i</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_variability.html">generate_iiv</a></span><span class="op">(</span></span>
<span>    sim_model <span class="op">=</span> <span class="va">model</span>,</span>
<span>    omega <span class="op">=</span> <span class="va">omega</span>,</span>
<span>    parameters <span class="op">=</span> <span class="va">parameters</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">treatment_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sample_and_adjust_by_dose.html">sample_and_adjust_by_dose</a></span><span class="op">(</span></span>
<span>    adjust_at_dose <span class="op">=</span> <span class="va">adjust_at_dose</span>,</span>
<span>    tdm_times <span class="op">=</span> <span class="va">tdm_times</span>,</span>
<span>    regimen <span class="op">=</span> <span class="va">reg</span>,</span>
<span>    covariates <span class="op">=</span> <span class="va">covs</span>,</span>
<span>    pars_true_i <span class="op">=</span> <span class="va">pars_true_i</span>,</span>
<span>    sim_model <span class="op">=</span> <span class="va">model</span>,</span>
<span>    sim_ruv <span class="op">=</span> <span class="va">ruv</span>,</span>
<span>    est_model <span class="op">=</span> <span class="va">model</span>,</span>
<span>    parameters <span class="op">=</span> <span class="va">parameters</span>,</span>
<span>    omega <span class="op">=</span> <span class="va">omega</span>,</span>
<span>    ruv <span class="op">=</span> <span class="va">ruv</span>,</span>
<span>    target_time <span class="op">=</span> <span class="va">conc_times</span>,</span>
<span>    target <span class="op">=</span> <span class="va">target</span>,</span>
<span>    dose_optimization_method <span class="op">=</span> <span class="va">dose_adjust_map</span></span>
<span>  <span class="op">)</span></span>
<span>    </span>
<span>  <span class="co"># get final asparaginase activity level</span></span>
<span>  <span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu">PKPDsim</span><span class="fu">::</span><span class="fu"><a href="https://insightrx.github.io/PKPDsim/reference/sim.html" class="external-link">sim</a></span><span class="op">(</span></span>
<span>    <span class="va">model</span>,</span>
<span>    parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">pars_true_i</span><span class="op">)</span>, <span class="co"># true patient parameters</span></span>
<span>    regimen <span class="op">=</span> <span class="va">treatment_summary</span><span class="op">$</span><span class="va">final_regimen</span>,</span>
<span>    covariates <span class="op">=</span> <span class="va">covs</span>,</span>
<span>    ruv <span class="op">=</span> <span class="va">ruv</span>,</span>
<span>    t_obs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">14</span>, <span class="fl">28</span>, <span class="fl">42</span><span class="op">)</span> <span class="op">*</span> <span class="fl">24</span>,</span>
<span>    only_obs <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">conc</span>  <span class="op">&lt;-</span> <span class="va">sim</span><span class="op">$</span><span class="va">y</span></span>
<span>  <span class="va">results</span><span class="op">$</span><span class="va">conc</span><span class="op">[</span><span class="va">results</span><span class="op">$</span><span class="va">id</span> <span class="op">==</span> <span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">conc</span></span>
<span>  </span>
<span>  <span class="co">#Add amounts</span></span>
<span>  <span class="va">amt</span> <span class="op">&lt;-</span> <span class="va">treatment_summary</span><span class="op">$</span><span class="va">final_regimen</span><span class="op">$</span><span class="va">dose_amts</span></span>
<span>  <span class="va">results</span><span class="op">$</span><span class="va">amt</span><span class="op">[</span><span class="va">results</span><span class="op">$</span><span class="va">id</span> <span class="op">==</span> <span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">amt</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Here are the first few rows of our simulation results:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="co">#&gt;      id iter day  amt     conc</span></span>
<span><span class="co">#&gt; 1 66117    1  14 1391 597.4713</span></span>
<span><span class="co">#&gt; 2 66117    2  28 1488 375.0129</span></span>
<span><span class="co">#&gt; 3 66117    3  42 1488 341.5836</span></span>
<span><span class="co">#&gt; 4 68796    1  14  769 410.2427</span></span>
<span><span class="co">#&gt; 5 68796    2  28  864 274.9013</span></span>
<span><span class="co">#&gt; 6 68796    3  42  864 293.9840</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="analyze-results">6. Analyze results<a class="anchor" aria-label="anchor" href="#analyze-results"></a>
</h2>
<p>How well did our patients get to target?</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">day</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">14</span>,<span class="fl">28</span>,<span class="fl">42</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">conc</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    below_flag <span class="op">=</span> <span class="va">conc</span> <span class="op">&lt;</span> <span class="fl">100</span>,</span>
<span>    within_flag <span class="op">=</span> <span class="va">conc</span> <span class="op">&gt;=</span> <span class="fl">100</span> <span class="op">&amp;</span> <span class="va">conc</span> <span class="op">&lt;=</span> <span class="fl">500</span>,</span>
<span>    above_flag <span class="op">=</span> <span class="va">conc</span> <span class="op">&gt;</span> <span class="fl">500</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">day</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>    below_per <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">below_flag</span><span class="op">)</span>,</span>
<span>    within_per <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">within_flag</span><span class="op">)</span>,</span>
<span>    above_per <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">above_flag</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">below_per</span>,<span class="va">within_per</span>,<span class="va">above_per</span><span class="op">)</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"per_type"</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"per"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    per_type <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">per_type</span> <span class="op">==</span> <span class="st">"below_per"</span> <span class="op">~</span> <span class="st">"C. &lt; 0.1 IU/mL"</span>,</span>
<span>      <span class="va">per_type</span> <span class="op">==</span> <span class="st">"within_per"</span> <span class="op">~</span> <span class="st">"B. 0.1 - 0.5 IU/mL"</span>,</span>
<span>      <span class="va">per_type</span> <span class="op">==</span> <span class="st">"above_per"</span> <span class="op">~</span> <span class="st">"A. &gt; 0.5 IU/mL"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">day</span>, <span class="va">per</span>, <span class="va">per_type</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">day</span>,</span>
<span>      y <span class="op">=</span> <span class="va">per</span><span class="op">*</span><span class="fl">100</span>,</span>
<span>      group <span class="op">=</span> <span class="va">per_type</span>,</span>
<span>      fill <span class="op">=</span> <span class="va">per_type</span>,</span>
<span>      label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">per</span> <span class="op">*</span> <span class="fl">100</span>,<span class="fl">1</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span>, <span class="st">""</span> , <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">per</span><span class="op">*</span><span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat<span class="op">=</span><span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span>, position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_stack.html" class="external-link">position_stack</a></span><span class="op">(</span>vjust <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Percent (%)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Time (d)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.major.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">14</span>,<span class="fl">28</span>,<span class="fl">42</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">14</span>,<span class="fl">28</span>,<span class="fl">42</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#3870FA"</span>, <span class="st">"#35BCB1"</span>, <span class="st">"#FF8C00"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="pegasp_mipd_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<p>While further work is needed to establish a realistic upper toxicity
threshold to inform the therapeutic window of PEG-asparaginase, an MIPD
approach informed by AAL levels which are already germane to therapeutic
care with PEG-asparaginase may translate to better target attainment and
cost savings. For further details, see [Brooks et al., PAGE Meeting;
June 26-28, 2024, Rome, Italy. (<a href="https://www.page-meeting.org/default.asp?abstract=10796" class="external-link uri">https://www.page-meeting.org/default.asp?abstract=10796</a>)].</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jasmine Hughes, InsightRX.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
